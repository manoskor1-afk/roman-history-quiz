
import streamlit as st

st.set_page_config(page_title="Ιστορία Ε' Δημ. - Ρωμαϊκή Εποχή (Quiz)", page_icon="🏺", layout="centered")

st.title("🏺 Ιστορία Ε’ Δημοτικού: Ρωμαϊκή Εποχή — Διαδραστικό Quiz")
st.write("Ερωτήσεις από το υλικό επανάληψης. Διάλεξε μάθημα, απάντησε **μία-μία** τις ερωτήσεις και πάρε **άμεση ανατροφοδότηση**.")

# -------------------------
# Δεδομένα Quiz (αυστηρά από το αρχείο)
# Κάθε απάντηση/δήλωση είναι σε *ακριβή* διατύπωση από το PDF.
# Για τις ερωτήσεις πολλαπλής επιλογής, οι επιλογές είναι αυτούσιες απαντήσεις από το ίδιο μάθημα (ή γειτονικά),
# ώστε να μην εισάγεται λεξιλόγιο εκτός αρχείου.
# -------------------------

LESSONS = {
    "Μάθημα 1": [
        # MC
        {
            "type": "mc",
            "q": "Πότε κατέκτησαν οι Ρωμαίοι την Ελλάδα και πώς κυβέρνησαν στην αρχή;",
            "options": [
                "Το 146 π.Χ. οι Ρωμαίοι κατέκτησαν την Ελλάδα, ύστερα από μακροχρόνιους πολέμους. Στην αρχή κυβέρνησαν με πολύ σκληρό τρόπο, γιατί δυσκολεύονταν να διοικήσουν τις πολλές ελληνικές πόλεις.",
                "Η πρώτη τους φροντίδα ήταν να κρατήσουν τους Έλληνες χωρισμένους και να μην τους αφήσουν να συνεργαστούν.",
                "Στις πόλεις που συμμάχησαν μαζί τους ή δεν αντιστάθηκαν, οι Ρωμαίοι έδωσαν ανεξαρτησία ή αυτονομία.",
                "Στις πόλεις που αντιστάθηκαν φέρθηκαν ανελέητα. Γκρέμισαν τα τείχη, άρπαξαν θησαυρούς και έργα τέχνης, έβαλαν πολύ βαριούς φόρους, αφόπλισαν τους κατοίκους και πολλούς τους έκαναν αιχμαλώτους."
            ],
            "answer_idx": 0,
        },
        # MC
        {
            "type": "mc",
            "q": "Ποια ήταν η πρώτη φροντίδα των Ρωμαίων μετά την κατάκτηση;",
            "options": [
                "Η πρώτη τους φροντίδα ήταν να κρατήσουν τους Έλληνες χωρισμένους και να μην τους αφήσουν να συνεργαστούν. Γι’ αυτό κατάργησαν τα δημοκρατικά πολιτεύματα και τις συμμαχίες των πόλεων. Αυτό ήταν το σχέδιο που ονόμασαν «διαίρει και βασίλευε», δηλαδή «χώρισέ τους και έτσι θα μπορείς να τους κυβερνάς πιο εύκολα».",
                "Οι λεγεώνες, δηλαδή τα ρωμαϊκά στρατιωτικά σώματα, έμεναν συνεχώς στην Ελλάδα.",
                "Οι Έλληνες ένιωσαν μεγάλη δυσαρέσκεια, γιατί για πρώτη φορά ήταν σκλαβωμένοι σε έναν ξένο λαό.",
                "Στις πόλεις που αντιστάθηκαν φέρθηκαν ανελέητα."
            ],
            "answer_idx": 0,
        },
        # MC
        {
            "type": "mc",
            "q": "Πώς φέρθηκαν οι Ρωμαίοι στις πόλεις που αντιστάθηκαν;",
            "options": [
                "Στις πόλεις που αντιστάθηκαν φέρθηκαν ανελέητα. Γκρέμισαν τα τείχη, άρπαξαν θησαυρούς και έργα τέχνης, έβαλαν πολύ βαριούς φόρους, αφόπλισαν τους κατοίκους (δηλαδή τους πήραν τα όπλα) και πολλούς τους έκαναν αιχμαλώτους (τους έπιαναν και τους κρατούσαν σαν φυλακισμένους πολέμου ή σκλάβους). Εκεί έβαλαν μόνιμες ρωμαϊκές φρουρές και Ρωμαίους αξιωματούχους να κυβερνούν.",
                "Στις πόλεις που συμμάχησαν μαζί τους ή δεν αντιστάθηκαν, οι Ρωμαίοι έδωσαν ανεξαρτησία ή αυτονομία.",
                "Οι λεγεώνες έμεναν συνεχώς στην Ελλάδα και ζούσαν από τα προϊόντα της υπαίθρου.",
                "Οι Έλληνες ένιωσαν μεγάλη δυσαρέσκεια."
            ],
            "answer_idx": 0,
        },
        # TF (ακριβής πρόταση από το αρχείο → Σωστό)
        {
            "type": "tf",
            "statement": "Οι λεγεώνες, δηλαδή τα ρωμαϊκά στρατιωτικά σώματα, έμεναν συνεχώς στην Ελλάδα.",
            "answer": True,
        },
        # TF (ακριβής πρόταση από το αρχείο → Σωστό)
        {
            "type": "tf",
            "statement": "Οι Έλληνες ένιωσαν μεγάλη δυσαρέσκεια, γιατί για πρώτη φορά ήταν σκλαβωμένοι σε έναν ξένο λαό.",
            "answer": True,
        },
    ],
    "Μάθημα 2": [
        # MC
        {
            "type": "mc",
            "q": "Τι γνώρισαν οι Ρωμαίοι όταν κατέκτησαν την Ελλάδα;",
            "options": [
                "Με την κατάκτηση της Ελλάδας οι Ρωμαίοι γνώρισαν από κοντά τον ελληνικό πολιτισμό. Γοητεύτηκαν από τους ωραίους ναούς, τα αγάλματα των θεών και των ηρώων, τα θέατρα, τα στάδια και τις γιορτές τους. Στις πόλεις, και ιδιαίτερα στην Αθήνα, γνώρισαν σπουδαίους δασκάλους και δημιουργούς και θαύμασαν την πρόοδό τους στα γράμματα και στις τέχνες.",
                "Από τον θαυμασμό τους άλλαξαν την αρχική σκληρή συμπεριφορά και άρχισαν να αξιοποιούν τις γνώσεις των Ελλήνων.",
                "Έκτιζαν σπίτια και δημόσια κτίρια με ελληνικά σχέδια και τα στόλιζαν με αγάλματα και έργα τέχνης φτιαγμένα από Έλληνες τεχνίτες.",
                "Όλα αυτά έφεραν πιο κοντά τους δύο λαούς."
            ],
            "answer_idx": 0,
        },
        # MC
        {
            "type": "mc",
            "q": "Πώς άλλαξε η στάση των Ρωμαίων απέναντι στους Έλληνες;",
            "options": [
                "Από τον θαυμασμό τους άλλαξαν την αρχική σκληρή συμπεριφορά και άρχισαν να αξιοποιούν τις γνώσεις των Ελλήνων. Έτσι έκαναν παρόμοια έργα στη Ρώμη και σε άλλες περιοχές της αυτοκρατορίας.",
                "Μετέφραζαν στα λατινικά έργα αρχαίων Ελλήνων συγγραφέων και έπαιζαν στα θέατρά τους ελληνικές τραγωδίες και κωμωδίες.",
                "Έκτιζαν σπίτια και δημόσια κτίρια με ελληνικά σχέδια.",
                "Φιλέλληνες Ρωμαίοι αυτοκράτορες στόλιζαν την Αθήνα."
            ],
            "answer_idx": 0,
        },
        # TF (δύο ακριβείς προτάσεις)
        {
            "type": "tf",
            "statement": "Έμαθαν την ελληνική γλώσσα, που μιλιόταν σε πολλές χώρες της Ανατολής.",
            "answer": True,
        },
        {
            "type": "tf",
            "statement": "Μετέφραζαν στα λατινικά έργα αρχαίων Ελλήνων συγγραφέων και έπαιζαν στα θέατρά τους ελληνικές τραγωδίες και κωμωδίες.",
            "answer": True,
        },
        # MC
        {
            "type": "mc",
            "q": "Τι αποτέλεσμα είχε η συνεργασία Ελλήνων και Ρωμαίων;",
            "options": [
                "Όλα αυτά έφεραν πιο κοντά τους δύο λαούς και τους βοήθησαν να γνωρίσει καλύτερα ο ένας τον άλλο. Από αυτή τη συνύπαρξη και συνεργασία γεννήθηκε ένας νέος πολιτισμός, ο ελληνορωμαϊκός, του οποίου θαυμαστά έργα υπάρχουν ακόμη και σήμερα γύρω μας.",
                "Όρισαν τον αυτοκράτορα «πρώτο πολίτη» της χώρας και όλοι όφειλαν πίστη και υπακοή σ’ αυτόν.",
                "Μείωσαν τους φόρους και οργάνωσαν καλύτερα τον τρόπο είσπραξής τους.",
                "Όλα αυτά τα μέτρα έφεραν τάξη, ασφάλεια και δικαιοσύνη στην αυτοκρατορία για περίπου 200 χρόνια."
            ],
            "answer_idx": 0,
        },
    ],
    "Μάθημα 3": [
        # MC
        {
            "type": "mc",
            "q": "Πού έφτασαν οι κατακτήσεις των Ρωμαίων τρεις αιώνες μετά την υποταγή της Ελλάδας;",
            "options": [
                "Οι Ρωμαίοι συνέχισαν τις κατακτήσεις τους στη Δύση, στην Ανατολή και στη Βόρεια Αφρική. Όλες οι χώρες γύρω από τη Μεσόγειο έγιναν ρωμαϊκές επαρχίες και οι Ρωμαίοι την ονόμαζαν με περηφάνια «η θάλασσά μας» (mare nostrum).",
                "Στις αρχές του 1ου μ.Χ. αιώνα τα σύνορα της αυτοκρατορίας περικλείουν όλο τον τότε γνωστό κόσμο.",
                "Γιατί μέσα στο απέραντο ρωμαϊκό κράτος κατοικούσαν άνθρωποι από πολλές φυλές, με διαφορετικές γλώσσες, θρησκείες και συνήθειες.",
                "Όλα αυτά τα μέτρα έφεραν τάξη, ασφάλεια και δικαιοσύνη στην αυτοκρατορία για περίπου 200 χρόνια."
            ],
            "answer_idx": 0,
        },
        # TF
        {
            "type": "tf",
            "statement": "Στις αρχές του 1ου μ.Χ. αιώνα τα σύνορα της αυτοκρατορίας περικλείουν όλο τον τότε γνωστό κόσμο. Ο πληθυσμός της ξεπερνούσε τα 50 εκατομμύρια.",
            "answer": True,
        },
        # TF
        {
            "type": "tf",
            "statement": "Γιατί μέσα στο απέραντο ρωμαϊκό κράτος κατοικούσαν άνθρωποι από πολλές φυλές, με διαφορετικές γλώσσες, θρησκείες και συνήθειες.",
            "answer": True,
        },
        # MC
        {
            "type": "mc",
            "q": "Ποια μέτρα πήραν οι Ρωμαίοι για να κυβερνήσουν την αυτοκρατορία;",
            "options": [
                "Όρισαν τον αυτοκράτορα «πρώτο πολίτη» της χώρας και όλοι όφειλαν πίστη και υπακοή σ’ αυτόν.",
                "Έδωσαν τον τίτλο του Ρωμαίου πολίτη σε όσους κατακτημένους δέχονταν την κυριαρχία της Ρώμης.",
                "Διόρισαν ανώτερους Ρωμαίους κυβερνήτες (ανθύπατους), που επέβλεπαν τους τοπικούς άρχοντες και ενημέρωναν τον αυτοκράτορα. Μείωσαν τους φόρους και οργάνωσαν καλύτερα τον τρόπο είσπραξής τους. Ψήφισαν δικαιότερους νόμους και φρόντιζαν να τηρούνται από όλους.",
                "Όλα τα παραπάνω."
            ],
            "answer_idx": 3,
        },
        # MC
        {
            "type": "mc",
            "q": "Ποιο ήταν το αποτέλεσμα αυτών των μέτρων;",
            "options": [
                "Όλα αυτά τα μέτρα έφεραν τάξη, ασφάλεια και δικαιοσύνη στην αυτοκρατορία για περίπου 200 χρόνια. Τότε αναπτύχθηκαν η γεωργία, το εμπόριο, η ναυτιλία και η βιοτεχνία. Αυτή η περίοδος ονομάστηκε «ρωμαϊκή ειρήνη» (pax romana).",
                "Η Ρώμη ήταν η έδρα του αυτοκράτορα και η καρδιά του ρωμαϊκού κράτους.",
                "Η Ρώμη ήταν χτισμένη πλάι στον Τίβερη ποταμό και στολισμένη με ναούς, ωραία κτίρια και έργα τέχνης.",
                "Στον Παλατίνο λόφο ήταν χτισμένο και το παλάτι των αυτοκρατόρων."
            ],
            "answer_idx": 0,
        },
    ],
    "Μάθημα 4": [
        # MC
        {
            "type": "mc",
            "q": "Πού ήταν χτισμένη η Ρώμη και πώς ήταν στολισμένη;",
            "options": [
                "Η Ρώμη ήταν η έδρα του αυτοκράτορα και η καρδιά του ρωμαϊκού κράτους. Ήταν χτισμένη πλάι στον Τίβερη ποταμό και στολισμένη με ναούς, ωραία κτίρια και έργα τέχνης.",
                "Στην περίοδο ακμής της αυτοκρατορίας ο πληθυσμός της, μαζί με τους δούλους και τους ξένους, πλησίαζε το ενάμισι εκατομμύριο.",
                "Οι περισσότεροι κάτοικοι διέμεναν σε πολυκατοικίες και οι πιο εύποροι σε μονοκατοικίες.",
                "Οι κάτοικοι της υπαίθρου ήταν γεωργοί, βοσκοί, τεχνίτες και μικροέμποροι."
            ],
            "answer_idx": 0,
        },
        # TF
        {
            "type": "tf",
            "statement": "Στην περίοδο ακμής της αυτοκρατορίας ο πληθυσμός της, μαζί με τους δούλους και τους ξένους, πλησίαζε το ενάμισι εκατομμύριο.",
            "answer": True,
        },
        # MC
        {
            "type": "mc",
            "q": "Πού ζούσαν οι περισσότεροι κάτοικοι και οι πιο πλούσιοι;",
            "options": [
                "Οι περισσότεροι κάτοικοι διέμεναν σε πολυκατοικίες και οι πιο εύποροι σε μονοκατοικίες. Στον Παλατίνο λόφο ήταν χτισμένο και το παλάτι των αυτοκρατόρων.",
                "Οι κάτοικοι της υπαίθρου ήταν γεωργοί, βοσκοί, τεχνίτες και μικροέμποροι.",
                "Είχαν μεγάλα και γόνιμα αγροκτήματα.",
                "Όλοι αυτοί, πλούσιοι και φτωχοί, πήγαιναν συχνά στη Ρώμη για να πάρουν μέρος στις μεγάλες γιορτές και στους αγώνες."
            ],
            "answer_idx": 0,
        },
        # TF
        {
            "type": "tf",
            "statement": "Οι κάτοικοι της υπαίθρου ήταν γεωργοί, βοσκοί, τεχνίτες και μικροέμποροι.",
            "answer": True,
        },
        # MC
        {
            "type": "mc",
            "q": "Τι έκαναν οι μεγαλοϊδιοκτήτες γεωργοί;",
            "options": [
                "Είχαν μεγάλα και γόνιμα αγροκτήματα. Σε αυτά ήταν κτισμένα τα σπίτια τους και κοντά τους στάβλοι, ορνιθώνες και αποθήκες για τους καρπούς και τις ζωοτροφές. Όλα αυτά τα φρόντιζαν οι δούλοι που έμεναν μόνιμα εκεί.",
                "Οι μικροϊδιοκτήτες καλλιεργούσαν μόνοι τα κτήματά τους και ζούσαν από τα λίγα προϊόντα που παρήγαγαν.",
                "Τα παιδιά τους συνήθως εγκατέλειπαν την ύπαιθρο και αναζητούσαν εργασία και καλύτερη τύχη στο στρατό, στην πόλη, στις τέχνες και στα δημόσια έργα.",
                "Όλοι αυτοί, πλούσιοι και φτωχοί, πήγαιναν συχνά στη Ρώμη για γιορτές και αγώνες."
            ],
            "answer_idx": 0,
        },
    ],
}

# -------------------------
# Κατάσταση εφαρμογής
# -------------------------
if "lesson" not in st.session_state:
    st.session_state.lesson = None
if "q_idx" not in st.session_state:
    st.session_state.q_idx = 0
if "score" not in st.session_state:
    st.session_state.score = 0
if "finished" not in st.session_state:
    st.session_state.finished = False
if "answered" not in st.session_state:
    st.session_state.answered = False
if "last_correct" not in st.session_state:
    st.session_state.last_correct = None

# -------------------------
# Επιλογή Μαθήματος
# -------------------------
st.subheader("Επιλογή Μαθήματος")
cols = st.columns(4)
lesson_names = list(LESSONS.keys())
for i, name in enumerate(lesson_names):
    if cols[i].button(name, use_container_width=True):
        st.session_state.lesson = name
        st.session_state.q_idx = 0
        st.session_state.score = 0
        st.session_state.finished = False
        st.session_state.answered = False
        st.session_state.last_correct = None

st.markdown("---")

if st.session_state.lesson is None:
    st.info("Επίλεξε ένα μάθημα για να ξεκινήσεις το quiz.")
    st.stop()

questions = LESSONS[st.session_state.lesson]
total = len(questions)

st.write(f"**{st.session_state.lesson}** — Ερώτηση {st.session_state.q_idx + 1} από {total}")

q = questions[st.session_state.q_idx]

def next_question():
    st.session_state.answered = False
    st.session_state.last_correct = None
    if st.session_state.q_idx + 1 >= total:
        st.session_state.finished = True
    else:
        st.session_state.q_idx += 1

# -------------------------
# Απόδοση ερώτησης (μία-μία)
# -------------------------
if q["type"] == "mc":
    st.markdown("**(Πολλαπλής επιλογής)**")
    st.write(q["q"])
    # Χρήση radio για μοναδική επιλογή
    user_choice = st.radio("Επίλεξε μία απάντηση:", q["options"], index=None, key=f"radio_{st.session_state.q_idx}")
    check = st.button("Υποβολή απάντησης", type="primary")
    if check and user_choice is None:
        st.warning("Επίλεξε πρώτα μία απάντηση.")
    elif check and user_choice is not None and not st.session_state.answered:
        correct_idx = q["answer_idx"]
        is_correct = (user_choice == q["options"][correct_idx])
        st.session_state.answered = True
        st.session_state.last_correct = is_correct
        if is_correct:
            st.success("✅ Σωστά!")
            st.session_state.score += 1
        else:
            st.error("❌ Λάθος.\n\n**Σωστή απάντηση:**\n\n" + q["options"][correct_idx])
    if st.session_state.answered:
        st.markdown("---")
        if st.button("Επόμενη ερώτηση ➜"):
            next_question()

elif q["type"] == "tf":
    st.markdown("**(Σωστό / Λάθος)**")
    st.write(q["statement"])
    user_choice = st.radio("Είναι σωστή ή λάθος η παραπάνω πρόταση;", ["Σωστό", "Λάθος"], index=None, key=f"tf_{st.session_state.q_idx}")
    check = st.button("Υποβολή απάντησης", type="primary")
    if check and user_choice is None:
        st.warning("Επίλεξε πρώτα Σωστό ή Λάθος.")
    elif check and user_choice is not None and not st.session_state.answered:
        is_true = (user_choice == "Σωστό")
        is_correct = (is_true == q["answer"])
        st.session_state.answered = True
        st.session_state.last_correct = is_correct
        if is_correct:
            st.success("✅ Σωστά!")
            st.session_state.score += 1
        else:
            correct_text = "Σωστό" if q["answer"] else "Λάθος"
            st.error(f"❌ Λάθος.\n\n**Σωστή απάντηση:** {correct_text}")
    if st.session_state.answered:
        st.markdown("---")
        if st.button("Επόμενη ερώτηση ➜"):
            next_question()

# -------------------------
# Τέλος μαθήματος
# -------------------------
if st.session_state.finished:
    st.markdown("## ✅ Τέλος Μαθήματος")
    st.write(f"Βαθμολογία: **{st.session_state.score} / {total}**")
    percent = round(100 * st.session_state.score / total)
    st.progress(percent / 100)
    st.write(f"Ποσοστό επιτυχίας: **{percent}%**")
    if st.button("Ξεκίνημα από την αρχή του ίδιου μαθήματος"):
        st.session_state.q_idx = 0
        st.session_state.score = 0
        st.session_state.finished = False
        st.session_state.answered = False
        st.session_state.last_correct = None
    if st.button("Επιλογή άλλου μαθήματος"):
        st.session_state.lesson = None
        st.session_state.q_idx = 0
        st.session_state.score = 0
        st.session_state.finished = False
        st.session_state.answered = False
        st.session_state.last_correct = None
